{% extends 'base.html' %}
{% load static %}

{% block header %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css" integrity="sha512-rxThY3LYIfYsVCWPCW9dB0k+e3RZB39f23ylUYTEuZMDrN/vRqLdaCBo/FbvVT6uC2r0ObfPzotsfKF9Qc5W5g==" crossorigin="anonymous" />
<link rel="stylesheet" href="{% static 'css/edit_profile.css' %}">
{% endblock header %}

{% block content %}

<div class="col-10">
    <form action="" method="POST" enctype=multipart/form-data>
        {% csrf_token %}
    <div class="row">
        <div class="col-md-3 border-right">
                    <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                        <div class="preview text-center">
                            <img class="rounded-circle preview-img" height="160" width="170" src="{{profile.image.url}}">
                            <div class="browse-button">
                                <i class="fa fa-pencil-alt"></i>
                                <input class="browse-input" value={{profile.image.url}} style="display: block;" type="file" name="image" id="UploadedFile"/>
                            </div>
                            <span class="Error"></span>
                        </div>
                        <!-- <img class="rounded-circle preview-img" height="160" width="170" src="{{profile.image.url}}"> -->
                        <span class="font-weight-bold">{{ user.username }}</span>
                        <span class="text-black-50">{{ user.email }}</span>
                        <span> </span>
                    </div>
            </div>
            <div class="col-md-5 border-right">
                <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="text-right">Profile Settings</h4>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-6">
                            <label class="labels">Username:</label>
                            <input class="form-control" id="editEmailInput" type="text"
                            name="username" value={{user.username}} required placeholder="Your username"/>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <label class="labels">PhoneNumber</label>
                            <input name="phone_number" value="{{ user.profile.phone_number }}" type="text" class="form-control" placeholder="enter phone number">
                        </div>
                        <div class="col-md-12 date">
                            <label class="labels">Date of birth</label>
                            <div class="input-group input-append date" id="datePicker">
                                <input name="date_of_birth" type="text" value="{{ user.profile.date_of_birth|date:'d/m/Y' }}" class="form-control" name="date" />
                                <span class="input-group-addon add-on">
                                    <span style="font-size: 26px; padding: 6px;
                                        background-color: #EEEEEE;" class="fas fa-calendar-day">
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <label class="labels">Address</label>
                            <input  name="address" type="text" class="form-control" placeholder="enter address" value="{{ user.profile.address }}">
                        </div>
                        <div class="col-md-12">
                            <label class="labels">Bio</label>
                            <textarea class="form-control" type="text" id="editBioInput" name="bio" 
                            placeholder="Your Bio" >{{ profile.bio }}
                            </textarea>
                        </div>
                    </div>
                    <div class="row mt-3 mb-2">
                        <div class="col-md-6"><label class="labels">Country</label>
                            <select name="country" value="{{ user.profile.country }}" id="country-select" class="browser-default custom-select">
                            </select>                              
                        </div>
                        <!-- <input type="text" class="form-control" placeholder="country" value=""> -->
                        <div class="col-md-6"><label class="labels">State/Region</label>
                            <input type="text" name="state" class="form-control" value="{{ user.profile.state }}" placeholder="state">
                        </div>
                    </div>
                    <div class="mt-5 text-center">
                        <!-- <input class="btn btn-primary btn-block" type="submit" value="Submit"/> -->
                        <button class="btn btn-primary profile-button" type="submit">Save Profile</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center experience"><span>Work Experience</span><span class="border px-3 p-1 add-experience"><i class="fa fa-plus"></i>&nbsp;Experience</span></div><br>
                    <div class="col-md-12">
                        <label class="labels">Current Workplace</label>
                        <input type="text" name="work_exp" class="form-control" placeholder="experience" value="{{ user.profile.work_exp }}">
                    </div> <br>
                    <div class="col-md-12">
                        <label class="labels">Additional Details</label>
                        <input name="extra_info" type="text" class="form-control" placeholder="additional details" value="{{ user.profile.extra_info }}">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

 {% endblock content %}

 {% block js %}
 <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ==" crossorigin="anonymous"></script>
<script>

    // var brosweInput = document.getElementsByClassName('browse-input')
    // var preview = document.getElementsByClassName('preview-image')
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function(e) {
                console.log(e.target.result)
            $('.preview-img').attr('src', e.target.result);
            }
            
            reader.readAsDataURL(input.files[0]); // convert to base64 string
        }
    }

    $(".browse-input").change(function() {
        console.log('ayuuuuuu')
        readURL(this);
    });

    $(document).ready(function() {
    $('#datePicker')
        .datepicker({
            format: 'mm/dd/yyyy'
        })
        .on('changeDate', function(e) {
            // Revalidate the date field
            $('#eventForm').formValidation('revalidateField', 'date');
        });

    $('#eventForm').formValidation({
        framework: 'bootstrap',
        icon: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            name: {
                validators: {
                    notEmpty: {
                        message: 'The name is required'
                    }
                }
            },
            date: {
                validators: {
                    notEmpty: {
                        message: 'The date is required'
                    },
                    date: {
                        format: 'MM/DD/YYYY',
                        message: 'The date is not a valid'
                    }
                }
            }
        }
    });
});


$(document).ready(function() {
fetch('../../../static/countries.json')
  .then(response => response.json())
  .then(data => {
  	// Do something with your data
      var countrySelect = document.getElementById('country-select')
      var countries = data["countries"]
        countrySelect.innerHTML = ''
          for (var i = 0; i < countries.length; i++){
              var option = document.createElement('option')
              option.value = countries[i]
              option.innerText = countries[i]
              countrySelect.append(option)
          }
          countrySelect.value = 'Afghanistan'
      })
})
</script>

 {% endblock js %}